<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Passport  | OAuth APIs </title>    <link rel="stylesheet" href="/www.passportjs.org/vendor/bootstrap/2.2.1/css/bootstrap.css">
    <link rel="stylesheet" href="/www.passportjs.org/vendor/highlight/gc5f3dbd/styles/github.css">
    <link rel="stylesheet" href="/www.passportjs.org/assets/css/site.css">
  </head>
  <body>
    <div class="container">
      <div class="masthead">
  <ul class="nav nav-pills pull-right">
    <li><a href="./">ホーム</a></li>    <li class="active"><a href="guide/">使い方</a></li>  </ul>
  <h3><a href="/www.passportjs.org/"><img src="/www.passportjs.org/assets/images/logo-90px.png" class="logo"> Passport</a></h3>
</div>

      
<div class="row guide">
  <div class="span3 toc">
    <ul class="unstyled">
  <li><a href="/www.passportjs.org/guide/">はじめに</a></li>
  <li><a href="/www.passportjs.org/guide/authenticate/">認証</a></li>
  <li><a href="/www.passportjs.org/guide/configure/">設定方法</a></li>
  <li><a href="/www.passportjs.org/guide/username-password/">ユーザー名 &amp; パスワード</a></li>
  <li><a href="/www.passportjs.org/guide/openid/">OpenID</a></li>
  <li><a href="/www.passportjs.org/guide/oauth/">OAuth</a></li>
  <li><strong>対応しているサービス</strong></li>
  <ul>
    <li><a href="/www.passportjs.org/guide/facebook/">Facebook</a></li>
    <li><a href="/www.passportjs.org/guide/twitter/">Twitter</a></li>
    <li><a href="/www.passportjs.org/guide/google/">Google</a></li>
    <li><a href="/www.passportjs.org/guide/providers/">その他</a></li>
  </ul>
  <li><strong>認証スキーム</strong></li>
  <ul>
    <li><a href="/www.passportjs.org/guide/basic-digest/">Basic認証 &amp; Digest認証</a></li>
    <li><a href="/www.passportjs.org/guide/oauth-api/">OAuth</a></li>
    <li><a href="/www.passportjs.org/guide/oauth2-api/">OAuth 2.0</a></li>
    <li><a href="/www.passportjs.org/guide/other-api/">その他</a></li>
  </ul>
  <li><strong>操作</strong></li>
  <ul>
    <li><a href="/www.passportjs.org/guide/login/">ログイン</a></li>
    <li><a href="/www.passportjs.org/guide/logout/">ログアウト</a></li>
    <li><a href="/www.passportjs.org/guide/authorize/">権限付与</a></li>
  </ul>
  <li><a href="/www.passportjs.org/guide/profile/">ユーザープロフィール</a></li>
</ul>

  </div>
  <div class="span9 content">
    <h3 id="oauth">OAuth</h3>
<p><a href="http://oauth.net/">OAuth</a> は <a href="http://tools.ietf.org/html/rfc5849">RFC 5849</a> で策定された、外部のアプリケーションがユーザーのデータへのアクセス権を獲得できるようにする枠組みです。
この枠組みでは、ユーザーはアプリケーションにパスワードを供与する必要がありません。</p>
<p>このプロトコルを利用すれば、Web アプリケーションのセキュリティを改善することができます。
たとえば、パスワードを外部のサービスに供与することによるリスクを避けることができます。</p>
<p>OAuth 1.0 は未だに広く使われていますが、改良版である <a href="/www.passportjs.org/guide/oauth2-api/">OAuth 2.0</a> への切り替えが推奨されています。</p>
<p>OAuth によって API のエンドポイントを保護するためには、3つのステップを踏む必要があります。</p>
<ol>
<li>アプリケーションは、ユーザーに保護されたリソースへのアクセス許可をリクエストします</li>
<li>ユーザーに許可されると、アプリケーションにトークンが発行されます</li>
<li>アプリケーションはトークンを使って、保護されたリソースにアクセスします</li>
</ol>
<h4 id="issuing-tokens">Issuing Tokens</h4>
<p><a href="https://github.com/jaredhanson/oauthorize">OAuthorize</a>, a sibling project to
Passport, provides a tookit for implementing OAuth service providers.</p>
<p>The authorization process is a complex sequence that involves authenticating
both the requesting application and the user, as well as prompting the user for
permission, ensuring that enough detail is provided for the user to make an
informed decision.</p>
<p>Additionally, it is up to the implementor to determine what limits can be placed
on the application regarding scope of access, as well as subsequently enforcing
those limits.</p>
<p>As a toolkit, OAuthorize does not attempt to make implementation decisions.
This guide does not cover these issues, but does highly recommended that
services deploying OAuth have a complete understanding of the security
considerations involved.</p>
<h4 id="authenticating-tokens">Authenticating Tokens</h4>
<p>Once issued, OAuth tokens can be authenticated using the <a href="https://github.com/jaredhanson/passport-http-oauth">passport-http-oauth</a>
module.</p>
<h5 id="install">Install</h5>
<pre><code class="undefinedbash">$ npm install passport-http-oauth</code></pre>
<h5 id="configuration">Configuration</h5>
<pre><code class="undefinedjavascript">passport.use(<span class="string">'token'</span>, <span class="keyword">new</span> TokenStrategy(
  <span class="function"><span class="keyword">function</span><span class="params">(consumerKey, done)</span> {</span>
    Consumer.findOne({ key: consumerKey }, <span class="function"><span class="keyword">function</span> <span class="params">(err, consumer)</span> {</span>
      <span class="keyword">if</span> (err) { <span class="keyword">return</span> done(err); }
      <span class="keyword">if</span> (!consumer) { <span class="keyword">return</span> done(<span class="literal">null</span>, <span class="literal">false</span>); }
      <span class="keyword">return</span> done(<span class="literal">null</span>, consumer, consumer.secret);
    });
  },
  <span class="function"><span class="keyword">function</span><span class="params">(accessToken, done)</span> {</span>
    AccessToken.findOne({ token: accessToken }, <span class="function"><span class="keyword">function</span> <span class="params">(err, token)</span> {</span>
      <span class="keyword">if</span> (err) { <span class="keyword">return</span> done(err); }
      <span class="keyword">if</span> (!token) { <span class="keyword">return</span> done(<span class="literal">null</span>, <span class="literal">false</span>); }
      Users.findById(token.userId, <span class="function"><span class="keyword">function</span><span class="params">(err, user)</span> {</span>
        <span class="keyword">if</span> (err) { <span class="keyword">return</span> done(err); }
        <span class="keyword">if</span> (!user) { <span class="keyword">return</span> done(<span class="literal">null</span>, <span class="literal">false</span>); }
        <span class="comment">// fourth argument is optional info.  typically used to pass</span>
        <span class="comment">// details needed to authorize the request (ex: `scope`)</span>
        <span class="keyword">return</span> done(<span class="literal">null</span>, user, token.secret, { scope: token.scope });
      });
    });
  },
  <span class="function"><span class="keyword">function</span><span class="params">(timestamp, nonce, done)</span> {</span>
    <span class="comment">// validate the timestamp and nonce as necessary</span>
    done(<span class="literal">null</span>, <span class="literal">true</span>)
  }
));</code></pre>
<p>In contrast to other strategies, there are two callbacks required by OAuth.  In
OAuth, both an identifier for the requesting application and the user-specific
token are encoded as credentials.</p>
<p>The first callback is known as the &quot;consumer callback&quot;, and is used to find the
application making the request, including the secret assigned to it.  The second
callback is the &quot;token callback&quot;, which is used to indentify the user as well as
the token&#39;s corresponding secret.  The secrets supplied by the consumer and
token callbacks are used to compute a signature, and authentication fails if it
does not match the request signature.</p>
<p>A final &quot;validate callback&quot; is optional, which can be used to prevent replay
attacks by checking the timestamp and nonce used in the request.</p>
<h5 id="protect-endpoints">Protect Endpoints</h5>
<pre><code class="undefinedjavascript">app.get(<span class="string">'/api/me'</span>, 
  passport.authenticate(<span class="string">'token'</span>, { session: <span class="literal">false</span> }),
  <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> {</span>
    res.json(req.user);
  });</code></pre>
<p>Specify <code>passport.authenticate()</code> with the <code>token</code> strategy to protect API
endpoints.  Sessions are not typically needed by APIs, so they can be disabled.</p>
  </div>
</div>
      <div class="footer">
  <p>&copy; 2011-2013 Jared Hanson<br/><a href="https://github.com/stuartpb/passport-logo">Logo</a> by <a href="https://github.com/stuartpb">Stuart P. Bentley</a>, <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0</a><br>Translation by <a href="https://github.com/OrgaChem">OrgaChem</a>, <a href="https://github.com/e-mon">e-mon</p>
</div>

    </div>
    <script src="/www.passportjs.org/vendor/jquery/1.11.0/jquery.min.js"></script>
    <script src="/www.passportjs.org/assets/js/showorigin.js"></script>
  </body>
</html>
