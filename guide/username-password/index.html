<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Passport  | ユーザーID & パスワード </title>    <link rel="stylesheet" href="/vendor/bootstrap/2.2.1/css/bootstrap.css">
    <link rel="stylesheet" href="/vendor/highlight/gc5f3dbd/styles/github.css">
    <link rel="stylesheet" href="/assets/css/site.css">
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-104798-10']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </head>
  <body>
    <div class="container">
      <div class="masthead">
  <ul class="nav nav-pills pull-right">
    <li><a href="/">ホーム</a></li>    <li class="active"><a href="/guide/">使い方</a></li>  </ul>
  <h3><a href="/"><img src="/assets/images/logo-90px.png" class="logo"> Passport</a></h3>
</div>

      
<div class="row guide">
  <div class="span3 toc">
    <ul class="unstyled">
  <li><a href="/guide/">はじめに</a></li>
  <li><a href="/guide/authenticate/">認証</a></li>
  <li><a href="/guide/configure/">設定方法</a></li>
  <li><a href="/guide/username-password/">ユーザー名 &amp; パスワード</a></li>
  <li><a href="/guide/openid/">OpenID</a></li>
  <li><a href="/guide/oauth/">OAuth</a></li>
  <li><strong>対応しているサービス</strong></li>
  <ul>
    <li><a href="/guide/facebook/">Facebook</a></li>
    <li><a href="/guide/twitter/">Twitter</a></li>
    <li><a href="/guide/google/">Google</a></li>
    <li><a href="/guide/providers/">その他</a></li>
  </ul>
  <li><strong>認証スキーム</strong></li>
  <ul>
    <li><a href="/guide/basic-digest/">Basic認証 &amp; Digest認証</a></li>
    <li><a href="/guide/oauth-api/">OAuth</a></li>
    <li><a href="/guide/oauth2-api/">OAuth 2.0</a></li>
    <li><a href="/guide/other-api/">その他</a></li>
  </ul>
  <li><strong>操作</strong></li>
  <ul>
    <li><a href="/guide/login/">ログイン</a></li>
    <li><a href="/guide/logout/">ログアウト</a></li>
    <li><a href="/guide/authorize/">権限付与</a></li>
  </ul>
  <li><a href="/guide/profile/">ユーザープロフィール</a></li>
</ul>

  </div>
  <div class="span9 content">
    <h3 id="-id-">ユーザーID &amp; パスワード</h3>
<p>多くの Web サイトの認証に、ユーザーID/パスワード認証が使われています。この認証メカニズムは <a href="https://github.com/jaredhanson/passport-local">passport-local</a> モジュールによって提供されています。</p>
<h4 id="-">インストール</h4>
<pre><code class="undefinedbash">$ npm install passport-local</code></pre>
<h4 id="-">設定</h4>
<pre><code class="undefinedjavascript"><span class="keyword">var</span> passport = require(<span class="string">'passport'</span>)
  , LocalStrategy = require(<span class="string">'passport-local'</span>).Strategy;

passport.use(<span class="keyword">new</span> LocalStrategy(
  <span class="function"><span class="keyword">function</span><span class="params">(username, password, done)</span> {</span>
    User.findOne({ username: username }, <span class="function"><span class="keyword">function</span><span class="params">(err, user)</span> {</span>
      <span class="keyword">if</span> (err) { <span class="keyword">return</span> done(err); }
      <span class="keyword">if</span> (!user) {
        <span class="keyword">return</span> done(<span class="literal">null</span>, <span class="literal">false</span>, { message: <span class="string">'Incorrect username.'</span> });
      }
      <span class="keyword">if</span> (!user.validPassword(password)) {
        <span class="keyword">return</span> done(<span class="literal">null</span>, <span class="literal">false</span>, { message: <span class="string">'Incorrect password.'</span> });
      }
      <span class="keyword">return</span> done(<span class="literal">null</span>, user);
    });
  }
));</code></pre>
<p>ローカルの認証に検証用コールバックには、アプリケーションのログインフォームによって送信されてきた <code>username</code> と <code>password</code> が引数として与えられています。</p>
<h4 id="-">フォーム</h4>
<p>ユーザーは Web ページ上のフォームから認証情報を入力できます。</p>
<pre><code class="undefinedxml"><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">"/login"</span> <span class="attribute">method</span>=<span class="value">"post"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">div</span>&gt;</span>
        <span class="tag">&lt;<span class="title">label</span>&gt;</span>Username:<span class="tag">&lt;/<span class="title">label</span>&gt;</span>
        <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">name</span>=<span class="value">"username"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
    <span class="tag">&lt;<span class="title">div</span>&gt;</span>
        <span class="tag">&lt;<span class="title">label</span>&gt;</span>Password:<span class="tag">&lt;/<span class="title">label</span>&gt;</span>
        <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"password"</span> <span class="attribute">name</span>=<span class="value">"password"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
    <span class="tag">&lt;<span class="title">div</span>&gt;</span>
        <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"submit"</span> <span class="attribute">value</span>=<span class="value">"Log In"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;/<span class="title">form</span>&gt;</span></code></pre>
<h4 id="-">ルート</h4>
<p>ログインフォームの内容は <code>POST</code> メソッドでサーバーに送信されます。
<code>local</code> ストラテジーでログイン要求を処理するためには、<code>authenticate()</code> を使います。</p>
<pre><code class="undefinedjavascript">app.post(<span class="string">'/login'</span>,
  passport.authenticate(<span class="string">'local'</span>, { successRedirect: <span class="string">'/'</span>,
                                   failureRedirect: <span class="string">'/login'</span>,
                                   failureFlash: <span class="literal">true</span> })
);</code></pre>
<p>検証用コールバック内で指定した <code>message</code> オプションで <code>error</code> メッセージなどをフラッシュメッセージとして表示するには、<code>failureFlash</code> オプションを <code>true</code> にしてください。</p>
<h4 id="-">パラメーター</h4>
<p><code>LocalStrategy</code> は認証情報を <code>username</code> と <code>password</code> の2つのパラメータ名で確認しています。
別のフィールド名を使っている場合は、確認するパラメータ名を変更してください。</p>
<pre><code>passport.use(new LocalStrategy({
    usernameField: <span class="string">'email'</span>,
    passwordField: <span class="string">'passwd'</span>
  },
  <span class="keyword">function</span>(username, password, done) {
    // <span class="keyword">...</span>
  }
));</code></pre>
  </div>
</div>
      <div class="footer">
  <p>&copy; 2011-2013 Jared Hanson<br/><a href="https://github.com/stuartpb/passport-logo">Logo</a> by <a href="https://github.com/stuartpb">Stuart P. Bentley</a>, <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0</a><br>Translation by <a href="https://github.com/OrgaChem">OrgaChem</a></p>
</div>

    </div>
  </body>
</html>
