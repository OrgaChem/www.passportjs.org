<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Passport  | Facebook </title>    <link rel="stylesheet" href="/www.passportjs.org/vendor/bootstrap/2.2.1/css/bootstrap.css">
    <link rel="stylesheet" href="/www.passportjs.org/vendor/highlight/gc5f3dbd/styles/github.css">
    <link rel="stylesheet" href="/www.passportjs.org/assets/css/site.css">
  </head>
  <body>
    <div class="container">
      <div class="masthead">
  <ul class="nav nav-pills pull-right">
    <li><a href="./">ホーム</a></li>    <li class="active"><a href="guide/">使い方</a></li>  </ul>
  <h3><a href="/www.passportjs.org/"><img src="/www.passportjs.org/assets/images/logo-90px.png" class="logo"> Passport</a></h3>
</div>

      
<div class="row guide">
  <div class="span3 toc">
    <ul class="unstyled">
  <li><a href="/www.passportjs.org/guide/">はじめに</a></li>
  <li><a href="/www.passportjs.org/guide/authenticate/">認証</a></li>
  <li><a href="/www.passportjs.org/guide/configure/">設定方法</a></li>
  <li><a href="/www.passportjs.org/guide/username-password/">ユーザー名 &amp; パスワード</a></li>
  <li><a href="/www.passportjs.org/guide/openid/">OpenID</a></li>
  <li><a href="/www.passportjs.org/guide/oauth/">OAuth</a></li>
  <li><strong>対応しているサービス</strong></li>
  <ul>
    <li><a href="/www.passportjs.org/guide/facebook/">Facebook</a></li>
    <li><a href="/www.passportjs.org/guide/twitter/">Twitter</a></li>
    <li><a href="/www.passportjs.org/guide/google/">Google</a></li>
    <li><a href="/www.passportjs.org/guide/providers/">その他</a></li>
  </ul>
  <li><strong>認証スキーム</strong></li>
  <ul>
    <li><a href="/www.passportjs.org/guide/basic-digest/">Basic認証 &amp; Digest認証</a></li>
    <li><a href="/www.passportjs.org/guide/oauth-api/">OAuth</a></li>
    <li><a href="/www.passportjs.org/guide/oauth2-api/">OAuth 2.0</a></li>
    <li><a href="/www.passportjs.org/guide/other-api/">その他</a></li>
  </ul>
  <li><strong>操作</strong></li>
  <ul>
    <li><a href="/www.passportjs.org/guide/login/">ログイン</a></li>
    <li><a href="/www.passportjs.org/guide/logout/">ログアウト</a></li>
    <li><a href="/www.passportjs.org/guide/authorize/">権限付与</a></li>
  </ul>
  <li><a href="/www.passportjs.org/guide/profile/">ユーザープロフィール</a></li>
</ul>

  </div>
  <div class="span9 content">
    <h3 id="facebook">Facebook</h3>
<p>ユーザーの Facebook アカウントを使ってログインするには、Facebook ストラテジーを使用します。
この認証には、OAuth2.0 を使用しています。</p>
<p>Facebook のサポートは <a href="https://github.com/jaredhanson/passport-facebook">passport-facebook</a> によって実装されています。</p>
<h4 id="-">インストール</h4>
<pre><code class="undefinedbash">$ npm install passport-facebook</code></pre>
<h4 id="-">設定方法</h4>
<p>Facebook 認証を行う前に、<a href="https://developers.facebook.com/">Facebook Developers</a> にてアプリケーションを登録する必要があります。
登録が完了すると、アプリケーションIDとアプリケーションシークレットが発行されます。
アプリケーション側ではリダイレクト用のURLを実装してください。このURLは、アクセスが許可された後にユーザーがリダイレクトされるページです。</p>
<pre><code class="undefinedjavascript"><span class="keyword">var</span> passport = require(<span class="string">'passport'</span>)
  , FacebookStrategy = require(<span class="string">'passport-facebook'</span>).Strategy;

passport.use(<span class="keyword">new</span> FacebookStrategy({
    clientID: FACEBOOK_APP_ID,
    clientSecret: FACEBOOK_APP_SECRET,
    callbackURL: <span class="string">"http://www.example.com/auth/facebook/callback"</span>
  },
  <span class="function"><span class="keyword">function</span><span class="params">(accessToken, refreshToken, profile, done)</span> {</span>
    User.findOrCreate(..., <span class="function"><span class="keyword">function</span><span class="params">(err, user)</span> {</span>
      <span class="keyword">if</span> (err) { <span class="keyword">return</span> done(err); }
      done(<span class="literal">null</span>, user);
    });
  }
));</code></pre>
<p>Facebook 認証のための検証用コールバック内では引数である <code>accessToken</code> と <code>refreshtoken</code>、<code>profile</code> が利用できます。
<code>profile</code> は Facebook 上のユーザープロフィール情報です（詳細は<a href="/guide/profile/">ユーザープロフィール</a>を参照してください）。</p>
<p><small>注意: セキュリティ上の理由で、リダイレクト用の URL は Facebook に登録したものと同じホストである必要があります。</small></p>
<h4 id="-">ルーティング</h4>
<p>Facebook 認証には2つのルーティングが必要です。
最初のルーティングではユーザーを Facebook へリダイレクトさせます。
次のルーティングでは、Facebook ログインの後でユーザーをリダイレクトさせます。</p>
<pre><code class="undefinedjavascript"><span class="comment">// 認証のためにユーザーを Facebook へリダイレクトさせます。認証が完了すると、</span>
<span class="comment">// ユーザーをアプリケーション上の以下のURLへとリダイレクトして戻します。</span>
<span class="comment">//     /auth/facebook/callback</span>
app.get(<span class="string">'/auth/facebook'</span>, passport.authenticate(<span class="string">'facebook'</span>));

<span class="comment">// ユーザーが許可すると、Facebook はユーザーをこのURLへリダイレクトします。</span>
<span class="comment">// アクセストークンの取得によって認証プロセスは完了します。</span>
<span class="comment">// 取得が成功すればユーザーはログインしたことになります。取得が失敗した場合は、</span>
<span class="comment">// 認証も失敗したとみなされます。</span>
app.get(<span class="string">'/auth/facebook/callback'</span>, 
  passport.authenticate(<span class="string">'facebook'</span>, { successRedirect: <span class="string">'/'</span>,
                                      failureRedirect: <span class="string">'/login'</span> }));</code></pre>
<p><small>注意: このコールバックルーティングの URL は、ストラテジーの設定時に <code>callbackURL</code> オプションで指定されたものです。</small></p>
<h4 id="-">アプリケーションの求めるアクセス許可</h4>
<p>アプリケーションがユーザーへさらに特定のアクセス許可を求める場合は、<code>scope</code> オプションの設定が必要になります。</p>
<pre><code class="undefinedjavascript">app.get(<span class="string">'/auth/facebook'</span>,
  passport.authenticate(<span class="string">'facebook'</span>, { scope: <span class="string">'read_stream'</span> })
);</code></pre>
<p>複数のアクセス許可を指定する場合は、配列を用いて指定します。</p>
<pre><code class="undefinedjavascript">app.get(<span class="string">'/auth/facebook'</span>,
  passport.authenticate(<span class="string">'facebook'</span>, { scope: [<span class="string">'read_stream'</span>, <span class="string">'publish_actions'</span>] })
);</code></pre>
<h4 id="-">リンク</h4>
<p>Facebook を使った1-クリックサインインは、リンクやボタンによって実現できます。</p>
<pre><code class="undefinedxml"><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/auth/facebook"</span>&gt;</span>Login with Facebook<span class="tag">&lt;/<span class="title">a</span>&gt;</span></code></pre>
  </div>
</div>
      <div class="footer">
  <p>&copy; 2011-2013 Jared Hanson<br/><a href="https://github.com/stuartpb/passport-logo">Logo</a> by <a href="https://github.com/stuartpb">Stuart P. Bentley</a>, <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0</a><br>Translation by <a href="https://github.com/OrgaChem">OrgaChem</a>, <a href="https://github.com/e-mon">e-mon</p>
</div>

    </div>
  </body>
</html>
